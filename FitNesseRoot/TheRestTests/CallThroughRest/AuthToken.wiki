---
Test
---
!contents -R2 -g -p -f -h
!1 Test AuthToken
Test that sending a valid authToken gives additional permissions compared to guest (no token).

!***> Configure !-RestFixture-!

| Table:smartrics.rest.fitnesse.fixture.RestFixtureConfig | |
| restfixture.default.headers | Content-Type: application/uub+record+json!-
-! |
| restfixture.content.handlers.map | application/uub+record+json=JSON |

*!
!***> Test create without token, should not be allowed (401)

| Table:smartrics.rest.fitnesse.fixture.RestFixture | ${systemUnderTestUrl} |
| setHeader | Content-Type:application/uub+record+json!-
-! |
| setBody | {"name":"text","children":[{"name":"recordInfo","children":[{"name":"id","value":"authTokenTestingText"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"systemOne"}]}]},{"name":"textPart","children":[{"name":"text","value":"En  text för att testa  authTokens"}],"attributes":{"type":"default","lang":"sv"}}]} |
| POST | /rest/record/textSystemOne | 401 | | |

*!
!***> Test create without invalid token, should not be allowed (401)

| Table:smartrics.rest.fitnesse.fixture.RestFixture | ${systemUnderTestUrl} |
| setHeader | Content-Type:application/uub+record+json !-
-!authToken:!-invalidToken
-! |
| setBody | {"name":"text","children":[{"name":"recordInfo","children":[{"name":"id","value":"authTokenTestingText"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"systemOne"}]}]},{"name":"textPart","children":[{"name":"text","value":"En  text för att testa  authTokens"}],"attributes":{"type":"default","lang":"sv"}}]} |
| POST | /rest/record/textSystemOne | 401 | | |

*!
!***> Test create without invalid token, should not be allowed (403)

| Table:smartrics.rest.fitnesse.fixture.RestFixture | ${systemUnderTestUrl} |
| setHeader | Content-Type:application/uub+record+json !-
-!authToken:!-fitnesseUserToken-!!-
-! |
| setBody | {"name":"system","children":[{"name":"recordInfo","children":[{"name":"id","value":"dummySystem"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"systemOne"}]}]},{"name":"systemName","value":"Dummy"}]} |
| POST | /rest/record/system | 403 | | |

*!
!***> Test create with token, should  be allowed

| Table:smartrics.rest.fitnesse.fixture.RestFixture | ${systemUnderTestUrl} |
| setHeader | Content-Type:application/uub+record+json!-
-!authToken:$authToken!-
-! |
| setBody | {"name":"text","children":[{"name":"recordInfo","children":[{"name":"id","value":"authTokenTestingText"},{"name":"dataDivider","children":[{"name":"linkedRecordType","value":"system"},{"name":"linkedRecordId","value":"systemOne"}]}]},{"name":"textPart","children":[{"name":"text","value":"En  text för att testa  authTokens"}],"attributes":{"type":"default","lang":"sv"}}]} |
| POST | /rest/record/textSystemOne | 201 | | |

*!
!***> Remove text

| Table:smartrics.rest.fitnesse.fixture.RestFixture | ${systemUnderTestUrl} |
| setHeader | Content-Type:application/uub+record+json!-
-!authToken:$authToken!-
-! | | | |
| DELETE | /rest/record/textSystemOne/authTokenTestingText | 200 | | |

*!
